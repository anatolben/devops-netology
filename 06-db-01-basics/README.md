# Решение домашнего задания к занятию "6.1. Типы и структура СУБД"

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

Ответ:  
Электронные чеки в json виде.  
Если основная задача хранение, то MongoDB.
Если основная задача поиск, то Elasticsearch.
Если это банковская система и основное требование ACID, то теоретически любая реляционная СУБД, например PostgreSQL (поддерживает JSON запросы).  

Склады и автомобильные дороги для логистической компании.
Если задача хранить пространственный тип данных (геоданные), то любая реляционная СУБД (практически все поддерживают пространственный тип данных).  

Генеалогические деревья.  
Иерархическая СУБД.  

Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации.  
Для кеширования наиболее подходят in-memory базы данных: Memcached, Redis.  

Отношения клиент-покупка для интернет-магазина.  
Так как отношения (а также финансы) подразумевают ACID, то любая реляционная база данных.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

Ответ:  
CAP.  
Данные записываются на все узлы с задержкой до часа (асинхронная запись):  
Каждый узел (не упавший) всегда успешно выполняет запросы (на чтение и запись) - (availability). Даже если между узлами нет связи, они продолжают работать независимо друг от друга - (partition tolerance).    
`PA`  
При сетевых сбоях, система может разделиться на 2 раздельных кластера:  
Каждый узел (не упавший) всегда успешно выполняет запросы (на чтение и запись) - (availability). Даже если между узлами нет связи, они продолжают работать независимо друг от друга - (partition tolerance).    
`PA`  
Система может не прислать корректный ответ или сбросить соединение:  
Каждый узел (не упавший) всегда успешно выполняет запросы (на чтение и запись) - (availability). Каждое чтение даст самую последнюю запись - (consistency).  
`CA`  

PACELC.
Данные записываются на все узлы с задержкой до часа (асинхронная запись):  
При разделении недоступна консистентность, иначе (Е) - консистентность (consistency).  
`PA/EC`  
При сетевых сбоях, система может разделиться на 2 раздельных кластера:  
При разделении недоступна консистентность, иначе (Е) консистентность (consistency) или высокая скорость ответа (latency) неизвестно.  
`PA/EL или PA/EL`  
Система может не прислать корректный ответ или сбросить соединение:
При разделении недоступна консистентность, иначе (Е) - консистентность (consistency).  
`PA/EC`  

## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

Ответ:  
Из данных двух определений, ACID - недостижимая идеализация желаемого.  
Каждый из её принципов может в некоторой мере приближать систему к этому недостижимому идеалу.  
Поэтому BASE это не столько противоположность ACID, сколько просто не идеальный вариант ACID.  
Поэтому да, принципы могут сочетаться в неких компромиссных пропорциях. А каждую конкретную СУБД надо анализировать по её функционалу в первую очередь, а не по теоретическим аббревеатурам принципов.  

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

Ответ:  
Это система Redis Pub/Sub.  
Возможно будет несколько вопросов, которые потребуют решения при использовании Redis.  
1) При возникновении проблем сохранение (запись на диск) сообщений, которые не были получены подписчиками.  
2) При потере соединения подписчиком, сохранение всех неполученных им сообщений.  
3) После восстановления соединения подписчиком, определение какие сообщения были получены, а какие нет. И все ли сообщения могут быть получены или уже получены, нет ли потерь.  

---
