# Решение домашнего задание к занятию "5.5. Оркестрация кластером Docker контейнеров на примере Docker Swarm"

## Задача 1

Дайте письменные ответы на следующие вопросы:

- В чём отличие режимов работы сервисов в Docker Swarm кластере: replication и global?
- Какой алгоритм выбора лидера используется в Docker Swarm кластере?
- Что такое Overlay Network?

Ответ.  
Существует два режима размещения сервисов на узлах кластера Docker Swarm:  
1) replication - когда мы задаем в конфигурации необходимое количество реплик сервиса, а диспетчер Docker Swarm поддерживает это количество автоматически размещая их на доступных узлах,  
2) global - когда диспетчер Docker Swarm поддерживает на каждом доступном узле один процесс данного сервиса исходя из ограничений, и наличия ресурсов.    
Причём под доступными узлами подразумеваются узлы, на которые не распространились ограничения заданные атрибутами и метаданными.  
По умолчанию задается режим - replication.  

Для выборов лидера применяется Raft - алгоритм консенсуса. 

Overlay Network - виртуальная сеть, такие сети создаёт Docker Swarm для прямого обмена между контейнерами.  
Где все контейнеры кластера находятся в этой одной сети, несмотря на нахождение узлов кластера в различных физических сетях.
Overlay Network создает туннели по технологии VxLAN (Virtual eXtensible Local Area Network). Когда ethernet кадры (layer 2) упаковываются в UDP сегменты (layer 4) и передаются по IP сети.  

## Задача 2

Создать ваш первый Docker Swarm кластер в Яндекс.Облаке

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker node ls
```
Ответ:  
[screenshot 01](https://i.imgur.com/9L4RzVK.png)  
![screenshot 01](https://i.imgur.com/9L4RzVK.png)  

## Задача 3

Создать ваш первый, готовый к боевой эксплуатации кластер мониторинга, состоящий из стека микросервисов.

Для получения зачета, вам необходимо предоставить скриншот из терминала (консоли), с выводом команды:
```
docker service ls
```
Ответ:  
[screenshot 02](https://i.imgur.com/GxLXa9p.png)  
![screenshot 02](https://i.imgur.com/GxLXa9p.png)  

## Задача 4 (*)

Выполнить на лидере Docker Swarm кластера команду (указанную ниже) и дать письменное описание её функционала, что она делает и зачем она нужна:
```
# см.документацию: https://docs.docker.com/engine/swarm/swarm_manager_locking/
docker swarm update --autolock=true
```

Ответ.  
[screenshot 03](https://i.imgur.com/K6iHY3s.png)  
![screenshot 03](https://i.imgur.com/K6iHY3s.png)  
Данная команда включает автоблокировку существующего запущенного кластера Docker Swarm.  
У кластера Docker Swarm существует два ключа: ключ для TLS соединений между manager узлами, и ключ для шифрования журналов протокола Raft при сохранении их на диск.  
Это сделано в целях безопасности кластера Docker Swarm.  
В момент останова кластера Docker Swarm, эти два ключа сохраняются на диск и не защищены.
Но режим автоблокировки создает третий ключ, который известен только владельцу кластера Docker Swarm. И которым шифруются два вышеуказанных ключа при сохранении их на диск в момент останова кластера.  
В итоге при запуске кластера Docker Swarm с включенным режимом автоблокировки, кластер не сможет автоматически запуститься, и будет ожидать от владельца ввода ключа для расшифровки своих ключей, которые были сохранены на диск.  

---